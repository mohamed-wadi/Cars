<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mon Profil - Aymen Car's</title>
    <link rel="stylesheet" href="../static/css/style.css">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-logo">
                <h2><a href="/" style="text-decoration: none; color: inherit;">Aymen Car's</a></h2>
            </div>
            <ul class="nav-menu">
                <li><a href="/">Accueil</a></li>
                <li><a href="/#services">Services</a></li>
                <li><a href="/#catalogue">Catalogue</a></li>
                <li><a href="/contact">Contact</a></li>
                <li><button class="btn-login" onclick="logout()">Déconnexion</button></li>
            </ul>
        </div>
    </nav>

    <!-- Section Profil -->
    <div class="container" style="margin-top: 120px;">
        <div class="profile-header" style="background: linear-gradient(135deg, #FF6600, #FFA040); color: white; padding: 2rem; border-radius: 15px; margin-bottom: 2rem;">
            <h1>Mon Profil</h1>
            <p>Gérez vos réservations et vos informations personnelles</p>
        </div>

        <!-- Section Réservations -->
        <div class="reservations-section" style="background: white; border-radius: 15px; padding: 2rem; box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);">
            <h2 style="color: #FF6600; margin-bottom: 1.5rem;">Mes Réservations</h2>
            <div id="reservations-container">
                <div style="text-align: center; padding: 2rem; color: #666;">Chargement de vos réservations...</div>
            </div>
        </div>
    </div>

    <script>
        // Configuration de l'API
        const API_BASE_URL = 'http://127.0.0.1:8000/api';
        
        // Charger les réservations de l'utilisateur
        async function loadUserReservations() {
            const container = document.getElementById('reservations-container');
            
            try {
                const response = await fetch(`${API_BASE_URL}/reservations/`);
                
                if (!response.ok) {
                    throw new Error('Erreur lors du chargement des réservations');
                }
                
                const reservations = await response.json();
                
                if (reservations.length === 0) {
                    container.innerHTML = `
                        <div style="text-align: center; padding: 3rem; color: #666;">
                            <h3>Aucune réservation trouvée</h3>
                            <p>Vous n'avez pas encore de réservations. Commencez par explorer notre catalogue !</p>
                            <a href="/" style="background: #FF6600; color: white; padding: 1rem 2rem; border-radius: 25px; text-decoration: none; display: inline-block; margin-top: 1rem;">Voir le catalogue</a>
                        </div>
                    `;
                    return;
                }
                
                // Générer les cartes de réservations
                const reservationsHTML = reservations.map(reservation => `
                    <div style="border: 1px solid #eee; border-radius: 10px; padding: 1.5rem; margin-bottom: 1rem;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                            <div style="font-weight: 600; font-size: 1.2rem;">${reservation.car.brand} ${reservation.car.model}</div>
                            <div style="padding: 0.5rem 1rem; border-radius: 20px; background: #e8f5e8; color: #2e7d32;">Confirmée</div>
                        </div>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-bottom: 1rem;">
                            <div>
                                <div style="font-size: 0.9rem; color: #666;">Agence de départ</div>
                                <div style="font-weight: 500;">${reservation.agency_start.name}</div>
                            </div>
                            <div>
                                <div style="font-size: 0.9rem; color: #666;">Date de début</div>
                                <div style="font-weight: 500;">${new Date(reservation.start_date).toLocaleDateString('fr-FR')}</div>
                            </div>
                            <div>
                                <div style="font-size: 0.9rem; color: #666;">Prix total</div>
                                <div style="font-weight: 500;">${reservation.total_price}€</div>
                            </div>
                        </div>
                        <div style="display: flex; gap: 1rem;">
                            <button style="background: #FF6600; color: white; border: none; padding: 0.5rem 1rem; border-radius: 5px; cursor: pointer;">Voir les détails</button>
                            <button style="background: #ff4444; color: white; border: none; padding: 0.5rem 1rem; border-radius: 5px; cursor: pointer;">Annuler</button>
                        </div>
                    </div>
                `).join('');
                
                container.innerHTML = reservationsHTML;
                
            } catch (error) {
                console.error('Erreur:', error);
                container.innerHTML = `
                    <div style="text-align: center; padding: 3rem; color: #666;">
                        <h3>Erreur de chargement</h3>
                        <p>Impossible de charger vos réservations. Veuillez réessayer plus tard.</p>
                    </div>
                `;
            }
        }
        
        // Fonction de déconnexion
        function logout() {
            localStorage.removeItem('token');
            localStorage.removeItem('user');
            localStorage.removeItem('isLoggedIn');
            window.location.href = '/';
        }
        
        // Charger les réservations au chargement de la page
        document.addEventListener('DOMContentLoaded', function() {
            loadUserReservations();
        });
    </script>
</body>
</html> 